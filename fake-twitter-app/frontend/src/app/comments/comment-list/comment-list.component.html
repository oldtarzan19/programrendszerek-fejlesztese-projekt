<!-- src/app/comments/comment-list/comment-list.component.html -->
<div class="comment-list-container">
  <h3>Comments</h3>

  <!-- Új komment űrlap -->
  <app-new-comment
    [tweetId]="tweetId"
    (commented)="loadComments()"
  ></app-new-comment>

  <div *ngIf="loading">Loading comments…</div>
  <div *ngIf="error" class="error">{{ error }}</div>

  <mat-list *ngIf="!loading && comments.length">
    <mat-list-item *ngFor="let c of comments">
      <mat-card class="comment-card">
        <mat-card-header>
          <mat-card-title>{{ c.user.username }}</mat-card-title>
          <mat-card-subtitle>{{ c.createdAt | date:'short' }}</mat-card-subtitle>
        </mat-card-header>

        <mat-card-content>
          <!-- Ha nincs szerkesztés -->
          <ng-container *ngIf="editingCommentId !== c._id; else editTpl">
            {{ c.content }}
          </ng-container>
          <!-- Szerkesztő űrlap -->
          <ng-template #editTpl>
            <form [formGroup]="editForm" class="edit-comment-form">
              <mat-form-field appearance="fill" class="full-width">
                <mat-label>Edit comment</mat-label>
                <textarea matInput formControlName="content" rows="2"></textarea>
              </mat-form-field>
            </form>
          </ng-template>
        </mat-card-content>

        <mat-card-actions>
          <!-- Edit gomb -->
          <button
            mat-icon-button
            *ngIf="canModify(c) && editingCommentId !== c._id"
            (click)="startEdit(c)"
          >
            <mat-icon>edit</mat-icon>
          </button>

          <!-- Save / Cancel gomb szerkesztés közben -->
          <ng-container *ngIf="editingCommentId === c._id">
            <button
              mat-button
              color="primary"
              (click)="saveEdit(c)"
              [disabled]="!editForm.valid"
            >
              Save
            </button>
            <button mat-button (click)="cancelEdit()">Cancel</button>
          </ng-container>

          <!-- Törlés gomb szerzőnek vagy adminnak -->
          <button
            mat-icon-button
            color="warn"
            *ngIf="canModify(c)"
            (click)="deleteComment(c)"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </mat-card-actions>
      </mat-card>
    </mat-list-item>
  </mat-list>

  <p *ngIf="!loading && !comments.length">No comments yet.</p>
</div>
